---
title: "Go程序是怎么样的"
date: 2023-04-18
tags : [                                    
     "Go基础语法",
 ]
categories : [                              
     "Go语言",
 ]
---

## 1. go程序命名

这里，我需要跟你啰嗦一下 Go 的命名规则。Go 源文件总是用**全小写字母形式的短小单词**命名，并且以.go 扩展名结尾。如果要在源文件的名字中使用多个单词，我们通常直接是将多个单词连接起来作为源文件名，而不是使用其他分隔符，比如下划线。也就是说，我们通常使用 helloworld.go 作为文件名而不是 hello_world.go。如果是以下划线分割的话有可能引发一些错误。

这是因为下划线这种分隔符，在 Go 源文件命名中有特殊作用，这个我们会在以后的讲解中详细说明。总的来说，我们尽量不要用两个以上的单词组合作为文件名，否则就很难分辨了。

>去看官方或者那些开源项目，确实命名的时候是按照上面的规范命名的，几乎没看到有下划线的。不推荐用下划线，又不推荐用组合，这其实给命名带来一些不方便。


##  2. go run和go build的区别

{{< admonition type=note  title="go run"  open=false  >}}
go run 编译并直接运行程序，它会产生一个临时文件（但实际不存在，也不会生成 .exe 文件），直接在命令行输出程序执行结果，方便用户调试，运行速度也相应较慢
- 执行go run，尽可能在main包下执行，否则会报错
- 执行go run，尽可能在大的目录下执行，因为单独执行某个文件，会出现找不到方法，变量的错误，这是因为go run的执行目录不对，而并非我们在程序中未定义
{{< /admonition >}}


{{< admonition type=tip  title="go build"  open=false  >}}
go build 用于测试编译包，主要检查是否会有编译错误，如果是一个可执行文件的源码（即是 main 包），就会在当前目录直接生成一个可执行文件（ .exe 文件）。运行速度快
{{< /admonition >}}


## 3. main函数
> 来看下面的函数
```go
package main

import "fmt"

func main() {
    fmt.Println("hello, world")
}
```
> 第一行
```go
package main
```
这一行代码定义了 Go 中的一个包 package。包是 Go 语言的基本组成单元，通常使用单个的小写单词命名，一个 Go 程序本质上就是一组包的集合。所有 Go 代码都有自己隶属的包，在这里我们的“hello，world”示例的所有代码都在一个名为 main 的包中。**main 包在 Go 中是一个特殊的包，整个 Go 程序中仅允许存在一个名为 main 的包。**

```go
func main() {
    fmt.Println("hello, world")
}
```

这里的 main 函数会比较特殊：当你运行一个可执行的 Go 程序的时候，所有的代码都会从这个入口函数开始运行。这段代码的第一行声明了一个名为 main 的、没有任何参数和返回值的函数。如果某天你需要给函数声明参数的话，那么就必须把它们放置在圆括号 () 中

另外，那对花括号{}被用来标记函数体，Go 要求所有的函数体都要被花括号包裹起来。按照惯例，我们推荐把左花括号与函数声明置于同一行并以空格分隔。Go 语言内置了一套 Go 社区约定俗称的代码风格，并随安装包提供了一个名为 Gofmt 的工具，这个工具可以帮助你将代码自动格式化为约定的风格。

>Gofmt 是 Go 语言在解决规模化（scale）问题上的一个最佳实践，并成为了 Go 语言吸引其他语言开发者的一大卖点。很多其他主流语言也在效仿 Go 语言推出自己的 format 工具，比如：Java formatter、Clang formatter、Dartfmt 等。因此，作为 Go 开发人员，请在提交你的代码前使用 Gofmt 格式化你的 Go 源码。**goland在提交之前是自动帮我们fmt的**。

## 4. fmt
{{< admonition type=note title="包名和导入路径的区别"  >}} 
看下面示例
```go
import "fmt"
fmt.Println("hello, world")
```
在 main 函数体中，通过 fmt 这个限定标识符（Qualified Identifier）调用 Println 函数。虽然两处都使用了“fmt”这个字面值，但在这两处“fmt”字面值所代表的含义却是不一样的：

-   import “fmt” 一行中“fmt”代表的是包的**导入路径（Import）**，它表示的是标准库下的 fmt 目录，整个 import 声明语句的含义是导入标准库 fmt 目录下的包；
-   fmt.Println 函数调用一行中的“fmt”代表的则是**包名**。[[Go module初步#3. 几个不错的问题]]

>通常导入路径的最后一个分段名与包名是相同的，这也很容易让人误解 import 声明语句中的“fmt”指的是包名，其实并不是这样的,不一定是包名，这两个名称有可能不一样的。

main 函数体中之所以可以调用 fmt 包的 Println 函数，还有最后一个原因，那就是 **Println 函数名的首字母是大写的**。在 Go 语言中，只有首字母为大写的标识符才是**导出的（Exported），才能对包外的代码可见；如果首字母是小写的，那么就说明这个标识符仅限于在声明它的包内可见**。
{{< /admonition >}}

另外，在 Go 语言中，main 包是不可以像标准库 fmt 包那样被导入（Import）的，如果导入 main 包，在代码编译阶段你会收到一个 Go 编译器错误：`import “xx/main” is a program, not an importable package`。

## 5. 分号
整个示例程序源码中，都没有使用过分号来标识语句的结束，这与 C、C++、Java 那些传统编译型语言好像不太一样呀？

其实 Go 语言的正式语法规范是使用分号“;”来做结尾标识符的。那为什么我们很少在 Go 代码中使用和看到分号呢？这是因为，大多数分号都是可选的，常常被省略，不过在源码编译时，Go 编译器会自动插入这些被省略的分号。我即便是写了分号，fmt的时候也会被去掉！

我们给上面的“hello，world”示例程序加上分号也是完全合法的，是可以直接通过 Go 编译器编译并正常运行的。不过，gofmt 在按约定格式化代码时，会自动删除这些被我们手工加入的分号的。

在分析完这段代码结构后，我们来讲一下 Go 语言的编译。虽然刚刚你应该已经运行过“hello, world”这个示例程序了，在这过程中，有一个重要的步骤——编译，现在我就带你来看看 Go 语言中程序是怎么进行编译的。

## 6. 编译
如果你之前更熟悉某种类似于 Ruby、Python 或 JavaScript 之类的动态语言，你可能还不太习惯在运行之前需要先进行编译的情况。Go 是一种编译型语言，这意味着只有你编译完 Go 程序之后，才可以将生成的可执行文件交付于其他人，并运行在没有安装 Go 的环境中。

而如果你交付给其他人的是一份.rb、.py 或.js 的动态语言的源文件，那么他们的目标环境中就必须要拥有对应的 Ruby、Python 或 JavaScript 实现才能解释执行这些源文件。

当然，Go 也借鉴了动态语言的一些对开发者体验较好的特性，比如基于源码文件的直接执行，Go 提供了 run 命令可以直接运行 Go 源码文件，比如我们也可以使用下面命令直接基于 main.go 运行：

```go
$go run main.go
hello, world
```

当然像 go run 这类命令更多用于开发调试阶段，真正的交付成果还是需要使用 go build 命令构建的。
但在我们的生产环境里，Go 程序的编译往往不会像我们前面，基于单个 Go 源文件构建类似“hello，world”这样的示例程序那么简单。越贴近真实的生产环境，也就意味着项目**规模越大、协同人员越多，项目的依赖和依赖的版本都会变得复杂**。