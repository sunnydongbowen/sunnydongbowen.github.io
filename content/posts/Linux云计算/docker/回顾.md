---
title: "docker~B站学习视频回顾"                         
author: "博文"   
date: 2023-05-10        
comments: true  
tags : [                                    
     "docker",
 ]
categories : [                              
     "Linux云计算",
 ]
---

>  文章是我看[B站上的视频](https://www.bilibili.com/video/BV1DT411U7v1?p=14&vd_source=4c2c9caf33151d42ae4b296d7b5f6f45) 30~40摘录的笔记，这套视频一共40个，还不错，可以当成入门视频。视频是宣传报班的，所以B站上只有到P40；白嫖党，有的看就不错了。


## 容器
容器是docker的核心概念，容器是一个或者一组应用，它的运行状态如下

-   docker利用容器运行应用程序
-   容器是镜像的运行实例，可以被run、start、stop、rm
-   每个容器都是相互隔离，保证平台安全
-   容器可以看作是一个简易版Linux环境(有root权限，进程、用户空间，网络)镜像是只读的，容器在启动的时候创建一层可写层。


## 镜像分层

![](/docker/20230510185353.png)


## dockerfile

dockerfile面向开发，docker image作为交付标准，docker container涉及部署和运维,，三者合起来完成docker体系。具体在dockerfile这篇文件里有介绍，这里只是简单回顾一下。

```bash
FROM ubuntu:14.84   # 选择基础锁像
ADD run.sh          # 添加文件进镜像，这一层镜像只有一个内容，就是这个文件
VOLUME /data        # 设定存储目录，并未添加文件，只是更新了镜像的json文件，便于启动时候读区该层信息更新ison文件
CMD ["./run.sh"]    # 设定程序入口
```

## 端口尽量放大一些

端口尽量大一点，比较小的端口一般系统可能占用了。建议8000以后开始使用。

```bash
docker run --name my_nginx  -d --restart=always -p 90:80 nginx
```

## 容器
```bash
docker run -it ubuntu bash
```

docker run启动容器的时候，docker后台操作流程是

-   检查本地是否有该镜像，没有就下载
-   利用镜像创建且启动一个容器
-   分配容器文件系统，在只读的镜像层挂载读写层
-   宿主机的网桥接口会分配一个虚拟接口到容器中
-   容器获得地址池里的ip地址
-   执行用户指定的程序
-   若程序里没有进程在运行，容器执行完毕后立即终止

## 回顾几个简单的容器命令
```bash
docker ps -a
docker container ls -a
docker top 容器id
docker stats 容器id
```

利用format获取容器的具体信息，不要小看这个命令，有了它可以通过脚本结合命令去获取容器信息的。
```bash
[root@centos8 ~]# docker inspect 1c2|grep 172
            "Gateway": "172.17.0.1",
            "IPAddress": "172.17.0.4",
                    "Gateway": "172.17.0.1",
                    "IPAddress": "172.17.0.4",
```

```bash
[root@centos8 ~]# docker inspect --format '{{.NetworkSettings.IPAddress}}' 1c2
172.17.0.4
```

## 容器化的优势

<font color="#ffc000">物理机→虚拟化→容器化</font>
-   想一下，一台64G的服务器，如果只是部署几个服务，那可惜了。还有服务多了会出现冲突问题。
-   虚拟机可以解决隔离问题，但是虚拟机4g，2核，如果说并发比较大，一下子就卡住了。代码和数据库的性能不说。且说这个硬件性能。2核的cpu处理那么多请求忙不过来。占用物理机的资源多。但是虚拟机也有虚拟机试用的场景，比如云主机，云课堂什么的。
-   一台服务器分50台虚拟机，却可以运行5000台容器，看出来区别了吧！

## LXC技术

LXC是<font color="#ffc000">Linux Containers</font>的缩写，是一种操作系统级别的虚拟化技术，类似于Docker容器。LXC通过利用Linux内核的cgroups和命名空间机制，将进程隔离在一个虚拟的环境中，实现了轻量级的虚拟化。

LXC与Docker类似，都是利用Linux内核的cgroups和命名空间机制实现容器化，但LXC是更基础的技术，它提供了更原始的容器环境。Docker在LXC的基础上进行了封装和扩展，提供了更高级的容器化工具和管理功能。

{{< admonition type=note title="LXC相对于Docker的优点在于"  >}} 

1.更接近操作系统：LXC提供的容器环境更接近于操作系统的原生环境，因此可以更好地支持一些需要操作系统级别访问权限的应用程序。

2.更灵活：LXC容器的配置比Docker更灵活，用户可以更细粒度地控制容器的各种参数，满足更多的特定需求。

3.更轻量级：由于LXC是更基础的技术，因此它的容器更轻量级，启动更快。

{{< /admonition >}}

{{< admonition type=warning title="但LXC相对于Docker的缺点在于"  >}} 

1.管理不方便：LXC相对于Docker的管理功能较弱，用户需要手动管理容器的各种参数，不够方便。

2.生态不够丰富：相对于Docker的生态环境，LXC的生态环境相对较弱，缺少相关工具和资源。
{{< /admonition >}}

> 综上所述，LXC是一种轻量级的容器化技术，比Docker更接近于操作系统的原生环境，更灵活，更轻量级。但它相对于Docker的管理功能较弱，生态环境不够丰富。Linux内核本身支持容器技术，LXC对Linux内核资源隔离（namespace，cgroup）, 市面上有很多基于LXC开发的容器管理软件，如创建容器，查看容器，管理容器，docker作为代表。

容器作用
1.  创建独立的namespace，一个隔离的环境
2.  以及对资源进行限制
3.  以及容器是直接使用宿主机硬件配置， (没有虚拟化这种的资源损耗)


## 再次复习

Docker最初DotCloud公司在法国期间发起的一个公司内部项目，后来以Apache2.0授权协议开源，代码在Github

-   Docker是基于Google公司出的Golang语言开发而来，其于Linux内核的Cgroups、NameSpace对进程进行封装隔离，属于操作系统层面的虚拟化技术以及Union FS等技术
-   由于隔离的进程独立于宿主机和其他隔离的进程，也被称之为容器
-   最初的Docker是基于LXC的，后来去除LXC转而使用自行开发的Libcontainer。
-   Docker被定义为开源的容器引擎，可以方便的对容器进行管理，例如对镜像打包封装，引入DockerRegistry对镜像统一管理。
-   利用Docker可以实现开发，测试，生产环境的部署一致性，极大的减少运维成本。

容器其实是宿主机上一个进程。kvm虚拟机也是啊！<font color="#92d050">ps -ef|grep </font>可以看到的。
基于docker的交付模式，基于docker的devops部署流水线，实现环境一致性，快速。
开发有时候不懂运维！测试不懂运维。但是现在测试也要会些运维了。Jenkins ，**开发，测试，运维。